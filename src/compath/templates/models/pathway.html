{% extends "base.html" %}

{% import "bootstrap/wtf.html" as wtf %}
{% import "bootstrap/fixes.html" as fixes %}
{% import "bootstrap/utils.html" as util %}

{% block title %}Pathway Details{% endblock %}
{% block styles %}
    {{ super() }}
    <style>
        ul {
            margin: 1em 0;
            padding: 0 0 0 40px;
        }

        li {
            margin: 1em 0;
        }
    </style>
{% endblock %}


{% macro write_label(resource) -%}
    {% if resource == 'kegg' %}
        label-success
    {% elif resource == 'reactome' %}
        label-danger
    {% elif resource == 'wikipathways' %}
        label-info
    {% elif resource == 'msig' %}
        label-default
    {% else %}
        label-warning
    {% endif %}
{%- endmacro %}


{% macro write_pathways(pathways, title) -%}
    {% if pathways|length > 0 %}
        <div class="panel panel-default">
            <div class="panel-heading">{{ title }}</div>
            <div class="panel-body">
                <ul>
                    {% for resource, identifier, name in pathways %}
                        <li>
                            <span class="label {{ write_label(resource) }}">
                                {{ resource|upper }}
                            </span>
                            &nbsp;
                            <a href="{{ url_for('model.pathway_view', resource=resource, identifier=identifier) }}">
                                {{ name }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% endif %}
{%- endmacro %}

{% block scripts %}
    {{ super() }}
    {% include "dependencies/common.html" %}
    <script type="text/javascript"
            src="{{ url_for('static', filename='js/pathway_controller.js', version='20181004') }}"></script>

    <script>
        // Initializes popover
        $(function () {
            $('[data-toggle="popover"]').popover({
                placement: 'top',
                trigger: 'hover'
            })
        });

        var resource = "{{resource}}";
        var pathwayName = "{{ pathway.name }}";
        var pathwayId = "{{pathway.resource_id }}";

    </script>
{% endblock %}

{% block content %}
    <div class="container" style="margin-top: 50px">
        {{ util.flashed_messages(dismissible=True, container=False) }}

        <div class="panel panel-default">
            <div class="panel-heading">{{ pathway.name }} - Pathway Page</div>
            <div class="panel-body">

                <table id="pathway-info" class="table table-bordered table-striped table-hover">
                    <tbody>
                    <tr>
                        <td>Name</td>
                        <td>
                            <a href="{{ pathway.url }}">{{ pathway }}</a>
                        </td>
                    </tr>
                    <tr>
                        <td>Resource</td>
                        <td>
                            {{ resource|upper }}
                        </td>
                    </tr>
                    <tr>
                        <td>Genes</td>
                        <td>
                            {% for hgnc_symbol in pathway.get_gene_set() %}
                                <a href="https://www.ncbi.nlm.nih.gov/gene/?term={{ hgnc_symbol }}">{{ hgnc_symbol }}</a>
                            {% endfor %}
                        </td>
                    </tr>
                    <tr>
                        <td>Size</td>
                        <td> {{ pathway.get_gene_set()|length }}
                        </td>
                    </tr>
                    </tbody>
                </table>

                {{ write_pathways(equivalent_pathways, "Equivalent Pathways") }}
                {{ write_pathways(super_pathways, "Super-Pathways") }}
                {{ write_pathways(sub_pathways, "Sub-Pathways") }}

                <div class="row">
                    <div class="text-center">
                        <div class="btn-group btn-space">
                            <a class="btn btn-primary"
                               data-toggle="popover" title="Suggest Pathways"
                               data-content="Suggests the most similar pathways according to genetic overlap">
                                Suggest Mappings By Overlap
                            </a>
                            <a class="btn btn-primary"
                               data-toggle="popover" title="Suggest Pathways"
                               data-content="Suggests the most similar pathways according to name similarity">
                                Suggest Mappings By Name
                            </a>
                            <button class="btn btn-primary" id="infer-mappings"
                                    data-toggle="popover" title="Infer Hierarchical Mappings in other Databases"
                                    data-content="Search for hierarchical mappings based on their equivalent pathways
                                    in other databases">Infer Hierarchical Mappings
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <table id="info-table" class="table table-bordered table-hover table-responsive"></table>
                </div>

            </div>
        </div>
    </div>
    {% include "footer.html" %}
{% endblock %}
